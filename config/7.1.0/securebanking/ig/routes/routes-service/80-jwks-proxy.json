{
  "comment": "JWK set proxy - provides publicly trusted route to Open Banking JWK publishing points protected with non-public SSL certs",
  "name": "80 - Open Banking JWKS Proxy",
  "auditService": "AuditService-OB-Route",
  "condition": "${matches(request.uri.path, '^/jwkms/jwksproxy')}",
  "handler": {
    "type": "Chain",
    "config": {
      "filters": [
        {
          "comment": "Add x-fapi-interaction-id header if one was not present in the request",
          "name": "FapiInteractionIdFilter",
          "type": "FapiInteractionIdFilter"
        },
        {
          "name": "JWKSProxyProcessRequest",
          "type": "ScriptableFilter",
          "config": {
            "type": "application/x-groovy",
            "file": "JWKSProxyProcessRequest.groovy",
            "args": {
              "_comment": "TODO: use env variable",
              "routeArgObJwksHosts": "[\"keystore.openbankingtest.org.uk\"]"
            }
          }
        },
        {
          "type": "ForwardedRequestFilter",
          "config": {
            "host": "${split(request.uri.path, '/')[1]}"
          }
        },
        {
          "name": "ReplaceEncodingFilter",
          "type": "HeaderFilter",
          "config": {
            "messageType": "RESPONSE",
            "remove": [
              "Content-Type"
            ],
            "add": {
              "Content-Type": [
                "application/json"
              ]
            }
          }
        }
      ],
      "handler": "OBReverseProxyHandler"
    }
  }
}